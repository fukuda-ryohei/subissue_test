name: Create Sub-Issue

on:
  issues:
    types: [opened]

jobs:
  create-sub-issue:
    runs-on: ubuntu-24.04
    steps:
    - name: Check if the issue uses the develop template
      id: check_template
      uses: actions/github-script@v3
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const issue_body = context.payload.issue.body;
          const is_develop_template = issue_body.includes('This is a develop issue template');
          return { is_develop_template };

    - name: Create Sub-Issue
      if: steps.check_template.outputs.is_develop_template == 'true'
      uses: actions/github-script@v3
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const { owner, repo } = context.repo;
          const issue_number = context.payload.issue.number;
          const subIssueTemplate = `# Sub-Issue Template\n\nThis is a sub-issue for the parent issue.`;
          const newIssue = await github.issues.create({
            owner,
            repo,
            title: `Sub-Issue for #${issue_number}`,
            body: subIssueTemplate,
            labels: ['sub-issue'],
          });
          await github.issues.createComment({
            owner,
            repo,
            issue_number,
            body: `Sub-issue created: #${newIssue.data.number}`
          });